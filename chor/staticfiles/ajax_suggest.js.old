//Gets the browser specific XmlHttpRequest Object
function getXmlHttpRequestObject() {
    console.debug("GettingXMLHTTP");
	if (window.XMLHttpRequest) {
		return new XMLHttpRequest();
	} else if(window.ActiveXObject) {
		return new ActiveXObject("Microsoft.XMLHTTP");
	} else {
		alert("Your Browser Sucks!\nIt's about time to upgrade don't you think?");
	}
}

//Called from keyup on the search textbox.
//Starts the AJAX request.
function searchSuggest() {
    searchReq = getXmlHttpRequestObject();
    if (searchReq.readyState == 4 || searchReq.readyState == 0) {
        console.debug("start suggest...");
		var str = escape(document.getElementById('txtSearch').value);
	searchReq.onreadystatechange = handleSearchSuggest;
    var myDate = new Date();
    var myTime = myDate.getTime();
    //searchReq.open("GET", 'http://127.0.0.1:8000/kalender/1/2011/', true);
    searchReq.open("GET", 'http://127.0.0.1:8000/kalender/ajax/category_suggest/?str=' + str + "&time=" + myTime, true);
        console.debug("sending");
		searchReq.send(null);
	}		
}

//Called when the AJAX response is returned.
function handleSearchSuggest() {
    console.debug("Handling suggest");
    if (searchReq.readyState == 4) {
        console.debug("ReadyState is 4");
		var ss = document.getElementById('suggest_suggestions')
		ss.innerHTML = '';
		var rstr = searchReq.responseText.split("\n");
                console.debug("Response:"+JSON.stringify(searchReq));
		for(i=0; i < rstr.length - 1; i++) {
			//Build our element string.  This is cleaner using the DOM, but
			//IE doesn't support dynamically added attributes.
			var suggest = '<div ';
			suggest += 'onclick="javascript:setSearch(this.innerHTML);" ';
			suggest += 'class="suggest_link">' + rstr[i] + '</div>';
			ss.innerHTML += suggest;
		}
	}
}

//Click function
function setSearch(value) {
	document.getElementById('suggest_field').value = value;
	document.getElementById('suggest_suggestions').innerHTML = '';
}
